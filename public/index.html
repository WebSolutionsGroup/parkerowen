<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parker Owen | Baseball Prospect</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FT6LLWLZ43"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-FT6LLWLZ43');
    </script>
</head>
<body>
    <div id="location-notice" style="display: none; position: fixed; top: 10px; left: 10px; background: #fff; padding: 10px; border: 1px solid #ccc;">
      We’d like to use your location to improve our analytics. Please allow when prompted.
    </div>
    <!-- Hero Section -->
    <header class="hero">
        <video autoplay muted loop playsinline class="hero-video">
            <source src="ParkerOwen.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <div class="hero-content">
            <h1>PARKER OWEN</h1>
            <p>Baseball Prospect | Strake Jesuit College Preparatory - Class of 2027 | Shortstop / Utility / Pitcher </p>
            <a href="#highlights" class="cta-button">Watch Highlights</a>
        </div>
    </header>

    <!-- Stats Bar -->
    <section class="stats">
        <div class="stat-item"><span>108</span> PA</div>
        <div class="stat-item"><span>84</span> AB</div>
        <div class="stat-item"><span>0.388</span> BA</div>
        <div class="stat-item"><span>0.519</span> OBP</div>
        <div class="stat-item"><span>0.971</span> OPS</div>
        <div class="stat-item"><span>35</span> H</div>
        <div class="stat-item"><span>3</span> SO</div>
    </section>

    <!-- About Section -->
    <section class="about">
        <img src="player.jpg" alt="Parker Owen" class="about-img">
        <div class="about-text">
            <h2>About Me</h2>
            <p>5’10”, 145 lbs | Shortstop / Utility / Pitcher from Pearland, TX.</p>
            <p>Parker Owen, a sophomore standout, showcases advanced offensive tools early in his high school career. Posting a .388 batting average across 84 at-bats, he demonstrates consistent contact ability, amassing 35 hits. His .519 on-base percentage reflects strong plate discipline, bolstered by an exceptional 3 strikeouts in 108 plate appearances—a rare mark of bat control for his age. An OPS of .971 hints at emerging power potential, suggesting extra-base capability. While still developing, Parker’s current production and approach signal a high ceiling worthy of attention from college and pro scouts.</p>
        </div>
    </section>

    <!-- Academics Section -->
    <section class="academics">
        <div class="academics-text">
            <h2>Academics</h2>
            <p>HONOR ROLL FALL 2023/SPRING 2024/FALL 2024</p>
            <p>AP STUDENT</p>
            <p>FOREIGN LANGUAGE - MANDARIN</p>
        </div>
    </section>

    <!-- Extracurriculars Section -->
    <section class="extracurriculars">
        <div class="extracurriculars-text">
            <h2>Extracurriculars</h2>
            <img src="camplonghorn.png" alt="Camp Longhorn" class="extracurriculars-img">
            <p>9 YEAR CAMP LONGHORN ATTENDEE AND FUTURE COUNSELOR</p>
            <img src="ymsl.png" alt="Young Men's Service League" class="extracurriculars-img">
            <p>MEMBER OF THE YOUNG MEN'S SERVICE LEAGUE</p>
        </div>
    </section>

    <!-- Highlights Section -->
    <section id="highlights" class="highlights">
        <h2>See Me in Action</h2>
        <iframe width="560" height="315" src="https://www.youtube.com/embed/N5Caxw2rYuE?si=fvmHE0M23Lx5Cixx" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>Contact: <a href="mailto:williamparkerowen@gmail.com">williamparkerowen@gmail.com</a></p>
            <div class="social-links">
                <a href="https://x.com/SP_Bsball" target="_blank" rel="noopener noreferrer" title="X">
                    <i class="fab fa-x-twitter"></i>
                </a>
                <a href="https://instagram.com/Parkerbsbl27" target="_blank" rel="noopener noreferrer" title="Instagram">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="https://tiktok.com/@parkerowen27" target="_blank" rel="noopener noreferrer" title="TikTok">
                    <i class="fab fa-tiktok"></i>
                </a>
            </div>
            <p class="created-by">Created by <a href="https://websolutionsgroup.com" target="_blank" rel="noopener noreferrer">Web Solutions Group, LLC</a></p>
        </div>
    </footer>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
      import { getAnalytics, logEvent } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-analytics.js";
      import { getFirestore, collection, addDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-firestore.js";
      import { getInstallations } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-installations.js";
    
      const firebaseConfig = {
        apiKey: "AIzaSyA23poM6Vx5Aegbrs8Rclm64aPQmhGT7ic",
        authDomain: "parkerowen-5190a.firebaseapp.com",
        projectId: "parkerowen-5190a",
        storageBucket: "parkerowen-5190a.firebasestorage.app",
        messagingSenderId: "150594269406",
        appId: "1:150594269406:web:97c280ad904574937b524f",
        measurementId: "G-FT6LLWLZ43"
      };
    
      try {
        const app = initializeApp(firebaseConfig);
        console.log('Firebase initialized:', app);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);
        const installations = getInstallations(app);
        console.log('Services initialized:', { analytics, db, installations });
    
        document.addEventListener('DOMContentLoaded', async () => {
          const urlParams = new URLSearchParams(window.location.search);
          const referrer = urlParams.get('ref') || 'direct';
          const step = urlParams.get('step') || 'direct';
          const pageLocation = window.location.href;
          const startTime = new Date();
          const visitId = `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
    
          const getFallbackLocation = async () => {
            try {
              const response = await fetch('https://ipapi.co/json/');
              const data = await response.json();
              return {
                latitude: data.latitude || 'N/A',
                longitude: data.longitude || 'N/A',
                locationDenied: false,
                method: 'IP-based'
              };
            } catch (error) {
              console.error('IP geolocation failed:', error);
              return { latitude: 'N/A', longitude: 'N/A', locationDenied: true, method: 'unknown' };
            }
          };
    
          const getUserLocation = () => {
            return new Promise((resolve) => {
              if (navigator.geolocation) {
                console.log('Requesting geolocation...');
                navigator.geolocation.getCurrentPosition(
                  (position) => {
                    resolve({
                      latitude: position.coords.latitude,
                      longitude: position.coords.longitude,
                      locationDenied: false,
                      method: 'navigator'
                    });
                  },
                  async (error) => {
                    console.warn('Geolocation error:', error.message);
                    const fallback = await getFallbackLocation();
                    resolve(fallback);
                  },
                  { timeout: 5000, maximumAge: 60000, enableHighAccuracy: true }
                );
              } else {
                console.warn('Geolocation not supported, using fallback');
                resolve(getFallbackLocation());
              }
            });
          };
    
          const notice = document.getElementById('location-notice');
          notice.style.display = 'block';
          let location;
          try {
            location = await getUserLocation();
          } catch (error) {
            console.error('Location fetch failed:', error);
            location = { latitude: 'N/A', longitude: 'N/A', locationDenied: true, method: 'unknown' };
          }
          notice.style.display = 'none';
    
          logEvent(analytics, 'page_visit', {
            referrer_id: referrer,
            step_id: step,
            page_location: pageLocation,
            latitude: String(location.latitude),
            longitude: String(location.longitude),
            location_denied: location.locationDenied,
            visit_id: visitId,
            timestamp: startTime.toISOString()
          });
    
          // Create the initial visit document and store its ID
          let visitDocRef;
          try {
            visitDocRef = await addDoc(collection(db, 'visits'), {
              referrer,
              step,
              pageLocation,
              startTime: startTime.toISOString(),
              latitude: location.latitude,
              longitude: location.longitude,
              locationDenied: location.locationDenied,
              method: location.method || 'unknown',
              userAgent: navigator.userAgent,
              visitId,
              timeSpent: 0,
              endTime: null
            });
            console.log('Visit logged to Firestore with ID:', visitDocRef.id);
          } catch (error) {
            console.error('Error logging initial visit to Firestore:', error);
          }
    
          // Function to update the visit document with time and location
          const updateVisitData = async () => {
            const timeSpent = Math.round((new Date() - startTime) / 1000);
            let updatedLocation = location; // Use the initial location by default
    
            // Attempt to get a fresh location
            try {
              const newLocation = await getUserLocation();
              // Only update if the new location is valid and different from the current one
              if (
                newLocation.latitude !== 'N/A' &&
                newLocation.longitude !== 'N/A' &&
                (newLocation.latitude !== location.latitude || newLocation.longitude !== location.longitude)
              ) {
                updatedLocation = newLocation;
              }
            } catch (error) {
              console.warn('Failed to update location:', error);
            }
    
            try {
              await updateDoc(doc(db, 'visits', visitDocRef.id), {
                timeSpent,
                endTime: new Date().toISOString(),
                latitude: updatedLocation.latitude,
                longitude: updatedLocation.longitude,
                locationDenied: updatedLocation.locationDenied,
                method: updatedLocation.method || 'unknown'
              });
              console.log('Visit updated - timeSpent:', timeSpent, 'location:', updatedLocation);
              location = updatedLocation; // Update the local location variable
            } catch (error) {
              console.error('Error updating visit:', error);
            }
          };
    
          // Update every 10 seconds
          const intervalId = setInterval(updateVisitData, 10000);
    
          // Final update on page unload
          window.addEventListener('beforeunload', () => {
            clearInterval(intervalId);
            updateVisitData(); // Final update
            logEvent(analytics, 'session_end', {
              referrer_id: referrer,
              time_spent: Math.round((new Date() - startTime) / 1000),
              page_location: pageLocation,
              visit_id: visitId
            });
          });
        });
      } catch (error) {
        console.error('Firebase setup failed:', error);
      }
    </script>
</body>
</html>